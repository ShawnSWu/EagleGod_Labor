name: EagleGod Labor Clock In

on:
  workflow_dispatch: # 由外部服務 (如 Cron-job.org) 觸發，確保時間精準

jobs:
  daka:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false  # 其中一人失敗時，不影響其他人執行
      matrix:
        include:
          - user_id: "SHAWN"
            account_key: "ACCOUNT"
            password_key: "PASSWORD"
            email_key: "RECEIVER_EMAIL"
          - user_id: "Lisa"
            account_key: "ACCOUNT_A"
            password_key: "PASSWORD_A"
            email_key: "RECEIVER_EMAIL_A"
          - user_id: "Winnie"
            account_key: "ACCOUNT_B"
            password_key: "PASSWORD_B"
            email_key: "RECEIVER_EMAIL_B"
          - user_id: "RLong"
            account_key: "ACCOUNT_C"
            password_key: "PASSWORD_C"
            email_key: "RECEIVER_EMAIL_C"

    env:
      LOGIN_URL: ${{ secrets.LOGIN_URL }}
      CHECKIN_URL: ${{ secrets.CHECKIN_URL }}
      EMAIL_USER: ${{ secrets.EMAIL_USER }}
      EMAIL_APP_PASSWORD: ${{ secrets.EMAIL_APP_PASSWORD }}
      # 動態根據矩陣選取不同的 Secret
      ACCOUNT: ${{ secrets[matrix.account_key] }}
      PASSWORD: ${{ secrets[matrix.password_key] }}
      RECEIVER_EMAIL: ${{ secrets[matrix.email_key] }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium

      - name: Execution - Clock In (${{ matrix.user_id }})
        run: python clock_in.py
